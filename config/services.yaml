services:
    _defaults:
          autowire: true

    Symfony\Component\Console\Application:
        public: true

# Symfony Command
    basic_block.command.create_board_command:
        public: true
        class: Aggrego\BasicBlockExample\Command\CreateBoardCommand
        tags: ['console.command']
        arguments:
            - '@messenger.bus'

    basic_block.command.transform_board_command:
        public: true
        class: Aggrego\BasicBlockExample\Command\TransformBoardCommand
        tags: ['console.command']
        arguments:
            - '@messenger.bus'

# Symfony Messenger
    messenger.bus:
        class: Symfony\Component\Messenger\MessageBus
        tags: ['messenger.bus']

    messenger.bus.middleware.handle_message:
        class: Symfony\Component\Messenger\Middleware\HandleMessageMiddleware
        arguments:
            - [] # Filled by MessengerPass

    console.command.messenger_debug:
        public: true
        class: Symfony\Component\Messenger\Command\DebugCommand
        tags: ['console.command']
        arguments:
            - [] # Filled by MessengerPass

    domain.api.create_board.use_case:
        class: Aggrego\Domain\Api\Command\CreateBoard\UseCase
        tags: [{name: 'messenger.message_handler', handles: Aggrego\Domain\Api\Command\CreateBoard\Command, method: 'handle'}]
        arguments:
            - "@basic_block.board.repository"
            - "@domain.board.new_board_factory"

    domain.api.transform_board.use_case:
        class: Aggrego\Domain\Api\Command\TransformBoard\UseCase
        tags: [{name: 'messenger.message_handler', handles: Aggrego\Domain\Api\Command\TransformBoard\Command, method: 'handle'}]
        arguments:
            - "@basic_block.board.repository"
            - "@domain.board.from_board_factory"

# Domain Board
    domain.board.new_board_factory:
        class: Aggrego\Domain\Board\NewBoardFactory
        arguments:
            - ['@domain.data_board.board.builder']
            - "@domain.profile.board_construction.factory"

    domain.board.from_board_factory:
        class: Aggrego\Domain\Board\FromBoardFactory
        arguments:
            - ['@domain.data_board.board.builder']
            - "@domain.profile.board_transformation.factory"

# Domain Profile
    domain.profile.board_construction.factory:
        class: Aggrego\Domain\Profile\BoardConstruction\Factory
        arguments:
            - ["@basic_block.domain.profile.board_construction.watchman"]

    domain.profile.board_transformation.factory:
        class: Aggrego\Domain\Profile\BoardTransformation\Factory
        arguments:
            - ["@basic_block.domain.profile.board_transformation.watchman"]

# Data Board
    domain.data_board.board.builder:
        class: Aggrego\DataBoard\Board\Builder

# BasicExample Profile
    basic_block.board.repository:
        class: Aggrego\BasicBlockExample\Domain\Board\Repository

    basic_block.domain.profile.board_construction.watchman:
        class: Aggrego\BasicBlockExample\Domain\Profile\BoardConstruction\Watchman

    basic_block.domain.profile.board_transformation.watchman:
        class: Aggrego\BasicBlockExample\Domain\Profile\BoardTransformation\Watchman


